use strict;
use warnings;
use v5.10;

my $input = do { local(@ARGV, $/) = "./inputs/19p2.txt"; <> };
my ($rules_input, $messages) = split(/\n\n/, $input);

my $regex = "^(?<g0>(?<g8>(?<g42>(?<g24>(?<g41>(?<g97>a)(?<g48>(?<g2>b)(?<g40>(?&g2)(?<g96>(?<g55>(?&g2)(?&g2))(?&g2)|(?<g104>(?&g2)(?&g2)|(?&g97)(?&g2))(?&g97))|(?&g97)(?<g119>(?<g32>(?&g2)(?&g2)|(?&g97)(?<g121>(?&g2)|(?&g97)))(?&g97)|(?<g66>(?&g2)(?&g97)|(?&g2)(?&g2))(?&g2)))|(?&g97)(?<g113>(?<g59>(?<g53>(?&g97)(?&g2)|(?&g97)(?&g97))(?&g97)|(?&g66)(?&g2))(?&g97)|(?<g35>(?<g25>(?&g97)(?&g97))(?&g2)|(?&g104)(?&g97))(?&g2)))|(?&g2)(?<g122>(?&g2)(?<g71>(?<g49>(?&g97)(?<g90>(?&g2)(?&g2)|(?&g97)(?&g97))|(?&g2)(?<g103>(?&g121)(?&g121)))(?&g97)|(?<g106>(?&g53)(?&g121))(?&g2))|(?&g97)(?<g86>(?<g84>(?&g55)(?&g97)|(?&g53)(?&g2))(?&g2)|(?&g59)(?&g97))))(?&g97)|(?<g109>(?&g2)(?<g117>(?&g2)(?<g65>(?&g2)(?&g96)|(?&g97)(?<g98>(?&g53)(?&g2)|(?&g25)(?&g97)))|(?&g97)(?<g92>(?<g102>(?&g104)(?&g97)|(?<g83>(?&g97)(?&g121)|(?&g2)(?&g97))(?&g2))(?&g97)|(?<g57>(?&g53)(?&g2)|(?&g83)(?&g97))(?&g2)))|(?&g97)(?<g18>(?<g123>(?<g4>(?&g2)(?&g103)|(?&g97)(?&g55))(?&g2)|(?<g85>(?&g83)(?&g97)|(?&g55)(?&g2))(?&g97))(?&g2)|(?<g61>(?<g38>(?&g2)(?&g104)|(?&g97)(?&g90))(?&g2)|(?<g9>(?&g97)(?&g66)|(?&g2)(?&g25))(?&g97))(?&g97)))(?&g2))(?&g2)|(?<g82>(?<g21>(?<g56>(?<g128>(?&g2)(?&g59)|(?&g97)(?<g3>(?&g97)(?<g29>(?&g97)(?&g97)|(?&g2)(?&g121))|(?&g2)(?&g104)))(?&g2)|(?<g20>(?<g93>(?&g2)(?&g66)|(?&g97)(?&g103))(?&g2)|(?<g69>(?&g97)(?<g95>(?&g97)(?&g2))|(?&g2)(?&g95))(?&g97))(?&g97))(?&g97)|(?<g105>(?<g30>(?&g97)(?<g88>(?&g83)(?&g97)|(?&g66)(?&g2))|(?&g2)(?<g54>(?&g2)(?&g53)|(?&g97)(?<g44>(?&g97)(?&g2)|(?&g2)(?&g97))))(?&g97)|(?<g87>(?<g101>(?&g83)(?&g97)|(?&g95)(?&g2))(?&g97)|(?<g91>(?&g104)(?&g97))(?&g2))(?&g2))(?&g2))(?&g2)|(?<g111>(?<g99>(?&g97)(?<g89>(?<g114>(?&g44)(?&g97)|(?&g90)(?&g2))(?&g97)|(?<g100>(?&g25)(?&g2)|(?&g95)(?&g97))(?&g2))|(?&g2)(?<g13>(?<g39>(?&g103)(?&g2)|(?&g104)(?&g97))(?&g97)|(?<g26>(?&g121)(?&g44))(?&g2)))(?&g2)|(?<g118>(?&g97)(?<g81>(?<g46>(?&g44)(?&g2)|(?&g90)(?&g97))(?&g2)|(?<g72>(?&g25)(?&g97)|(?&g95)(?&g2))(?&g97))|(?&g2)(?<g58>(?<g33>(?&g2)(?&g95)|(?&g97)(?&g83))(?&g97)|(?<g130>(?&g83)(?&g121))(?&g2)))(?&g97))(?&g97))(?&g97))|(?&g42)(?&g8))(?<g11>(?&g42)(?<g31>(?&g97)(?<g5>(?&g2)(?<g74>(?&g2)(?<g112>(?&g97)(?<g23>(?<g125>(?&g83)(?&g2)|(?&g32)(?&g97))(?&g121))|(?&g2)(?<g19>(?&g2)(?<g70>(?&g2)(?<g80>(?&g2)(?&g97)|(?&g97)(?&g97))|(?&g97)(?&g25))|(?&g97)(?<g78>(?&g2)(?&g95)|(?&g97)(?&g32))))|(?&g97)(?<g47>(?&g2)(?<g79>(?&g98)(?&g2)|(?<g124>(?&g2)(?<g6>(?&g2)(?&g97))|(?&g97)(?&g80))(?&g97))|(?&g97)(?<g108>(?<g43>(?&g104)(?&g97)|(?&g6)(?&g2))(?&g2)|(?<g68>(?&g97)(?&g53)|(?&g2)(?&g83))(?&g97))))|(?&g97)(?<g116>(?&g97)(?<g67>(?&g2)(?<g15>(?<g107>(?&g97)(?&g90)|(?&g2)(?&g32))(?&g97)|(?<g120>(?&g103)(?&g2)|(?&g66)(?&g97))(?&g2))|(?&g97)(?<g62>(?&g35)(?&g97)|(?&g114)(?&g2)))|(?&g2)(?<g77>(?<g126>(?&g97)(?&g119)|(?&g2)(?<g17>(?&g95)(?&g2)|(?&g90)(?&g97)))(?&g2)|(?<g22>(?&g59)(?&g97)|(?<g76>(?&g97)(?&g55)|(?&g2)(?&g104))(?&g2))(?&g97))))|(?&g2)(?<g132>(?&g97)(?<g27>(?&g2)(?<g52>(?<g16>(?&g4)(?&g2)|(?<g127>(?&g6)(?&g97)|(?&g55)(?&g2))(?&g97))(?&g97)|(?<g94>(?&g2)(?<g110>(?<g14>(?&g97)(?&g2)|(?&g2)(?&g121))(?&g2)|(?&g90)(?&g97))|(?&g97)(?<g129>(?&g2)(?&g66)|(?&g97)(?&g83)))(?&g2))|(?&g97)(?<g28>(?&g2)(?<g12>(?&g2)(?&g35)|(?&g97)(?<g51>(?&g6)(?&g2)|(?&g95)(?&g97)))|(?&g97)(?<g131>(?<g75>(?&g53)(?&g2)|(?&g104)(?&g97))(?&g97)|(?<g60>(?&g97)(?&g44)|(?&g2)(?&g25))(?&g2))))|(?&g2)(?<g45>(?&g97)(?<g10>(?<g63>(?&g97)(?<g37>(?&g6)(?&g97)|(?&g6)(?&g2))|(?&g2)(?<g36>(?&g2)(?&g104)|(?&g97)(?&g32)))(?&g2)|(?<g34>(?&g98)(?&g97)|(?<g50>(?&g53)(?&g97)|(?&g95)(?&g2))(?&g2))(?&g97))|(?&g2)(?<g73>(?&g2)(?<g1>(?&g75)(?&g2)|(?<g115>(?&g104)(?&g2)|(?&g29)(?&g97))(?&g97))|(?&g97)(?<g7>(?&g97)(?<g64>(?&g97)(?&g29)|(?&g2)(?&g14))|(?&g2)(?&g119))))))|(?&g42)(?&g11)(?&g31)))\$";

foreach (split(/\n/, $messages)) {
    if (m/$regex/) {
        say;
    }
}